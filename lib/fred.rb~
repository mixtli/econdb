require 'rubygems'
require 'open-uri'
require 'hpricot'
require 'activeresource'
API_KEY = "39e6580aa035fa02ef28ac0f5e2752b8"  

class Category < ActiveResource::Base
  self.site = "http://api.stlouisfed.org/fred"
  def self.collection_path(prefix_options = {}, query_options = nil)
    prefix_options, query_options = split_options(prefix_options) if query_options.nil?
    "#{prefix(prefix_options)}category/children#{query_string(query_options)}"
  end
end

puts Category.collection_path

puts Category.find(:all, :params => {:api_key => API_KEY})




class Fred
  def initialize(config = {})
    @api_key = API_KEY
    @url = config['url'] || "http://api.stlouisfed.org/fred"
  end
  
  def get_categories(parent_id = nil)
    categories = []
    uri = @url + "/category/children?api_key=" + @api_key
    if parent_id
      uri += "&parent_id=#{parent_id}"
    end
    puts uri
    doc = Hpricot.XML(open(uri))
    (doc/:categories/:category).each do |c|
      categories << c.attributes
    end
    categories
  end
  
  def get_category(id)
    uri = @url + "/category?api_key=#{@api_key}&category_id=#{id}"
    puts uri
    doc = Hpricot.XML(open(uri))        
    (doc/:categories/:category).first.attributes
  end

end

f = Fred.new

c = f.get_categories(125)
puts c.inspect

c2 = f.get_category(125)
puts c2.inspect
